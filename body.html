<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/r4fall1/vcxDts1946MeterStatics@v0/header.css">
<table class="styled-table">
    <thead>
        <tr>
            <th>Data description</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
		    <tr>
            <td>Water temperature</td>
            <td><span id="waterTemperature">0.00</span> <span>&#176;</span>C</td>
        </tr>
		    <tr>
            <td>Total heater operating time</td>
            <td><span id="heaterOperatingTime">0</span></td>
        </tr>
		    <tr>
            <td>Actual heater state</td>
            <td><span id="heaterStatus">OFF</span></td>
        </tr>
    </tbody>
</table>

<div class="container">
    <button class="btn" onclick="heaterTest()">Heater test</button>
</div>
<div class="title">
	Details:
</div>
<table class="styled-table">
    <thead>
        <tr>
            <th>Data description</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>A phase voltage</td>
            <td><span id="phase1Voltage">0.0</span> V</td>
        </tr>
        <tr>
            <td>B phase voltage</td>
            <td><span id="phase2Voltage">0.0</span> V</td>
        </tr>
		    <tr>
            <td>C phase voltage</td>
            <td><span id="phase3Voltage">0.0</span> V</td>
        </tr>
        <tr>
            <td>AB line voltage</td>
            <td><span id="phase1ToPhase2Voltage">0.0</span> V</td>
        </tr>
		    <tr>
            <td>BC line voltage</td>
            <td><span id="phase2ToPhase3Voltage">0.0</span> V</td>
        </tr>
        <tr>
            <td>CA line voltage</td>
            <td><span id="phase3ToPhase1Voltage">0.0</span> V</td>
        </tr>
    </tbody>
</table>
<script>
(function() {
	function updateHtmlField(id, value) {
	  if (value !== "nan")
		document.getElementById(id).innerHTML = value;
	}

	function msToTime(s) {
	  function pad(n, z) {
		z = z || 2;
		return ('00' + n).slice(-z);
	  }
	  var ms = s % 1000;
	  s = (s - ms) / 1000;
	  var secs = s % 60;
	  s = (s - secs) / 60;
	  var mins = s % 60;
	  var hrs = (s - mins) / 60;

	  return pad(hrs) + ':' + pad(mins) + ':' + pad(secs);
	}
	function updateValues() {
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		  console.log("params = " + this.responseText);
		  const vals = this.responseText.split(';');
		  updateHtmlField("phase1Voltage", vals[0]);
		  updateHtmlField("phase2Voltage", vals[1]);
		  updateHtmlField("phase3Voltage", vals[2]);
		  updateHtmlField("phase1ToPhase2Voltage", vals[3]);
		  updateHtmlField("phase2ToPhase3Voltage", vals[4]);
		  updateHtmlField("phase3ToPhase1Voltage", vals[5]);
		  updateHtmlField("waterTemperature", vals[6]);
		  updateHtmlField("heaterOperatingTime", msToTime(vals[7]));
		  updateHtmlField("heaterStatus", vals[8] > 0 ? "ON" : "OFF");
		};
	  }
	  xhttp.open("GET", "/params", false);
	  xhttp.send();
	}

	function heaterTest() {
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		  console.log("status = " + this.responseText);
		  updateValues();
		};
	  }
	  xhttp.open("GET", "/test", false);
	  xhttp.send();
	}
	
	setInterval(updateValues, 2000);
	updateValues();
})();
</script>